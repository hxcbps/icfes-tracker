<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Traductor Matem치tico | Saber 11 Master</title>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel para JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- MathJax Configuration (CONFIGURACI칍N ROBUSTA) -->
    <script>
        window.MathJax = {
            loader: { load: ['[tex]/ams'] },
            tex: {
                packages: { '[+]': ['ams'] },
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            chtml: {
                scale: 1.1,
                fontURL: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2'
            },
            options: {
                enableMenu: false,
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            startup: {
                typeset: false
            }
        };
    </script>
    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        body {
            background-color: #f8fafc;
            font-family: 'Inter', system-ui, sans-serif;
        }

        mjx-container {
            outline: none !important;
        }

        .math-display {
            overflow-x: auto;
            overflow-y: hidden;
            padding: 10px 0;
        }

        .fade-in {
            animation: fadeIn 0.4s ease-out;
        }

        .slide-up {
            animation: slideUp 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 4px;
        }

        /* Typography for "Book Mode" */
        .prose-custom h3 {
            color: #1e293b;
            font-weight: 800;
            margin-top: 2.5rem;
            margin-bottom: 1rem;
            font-size: 1.4rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 0.5rem;
        }

        .prose-custom h4 {
            color: #334155;
            font-weight: 700;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            font-size: 1.15rem;
        }

        .prose-custom p {
            color: #334155;
            line-height: 1.8;
            margin-bottom: 1.2rem;
            font-size: 1.05rem;
        }

        .prose-custom strong {
            color: #0f172a;
            font-weight: 700;
        }

        .prose-custom ul {
            list-style-type: disc;
            padding-left: 1.5rem;
            margin-bottom: 1rem;
            color: #334155;
        }

        .prose-custom li {
            margin-bottom: 0.5rem;
        }

        .prose-custom ol {
            list-style-type: decimal;
            padding-left: 1.5rem;
            margin-bottom: 1rem;
            color: #334155;
        }

        .btn-bounce:active {
            transform: scale(0.98);
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONOS ---
        const Icon = ({ path, size = 24, className = "", color = "currentColor" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const Icons = {
            Brain: <path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 4.44-4z M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-4.44-4z" />,
            Calc: <path d="M4 2h16a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V4a2 2 0 0 1-2-2z M8 6h8 M16 14v4 M12 14v4 M8 14v4" />,
            Trend: <><polyline points="23 6 13.5 15.5 8.5 10.5 1 18" /><polyline points="17 6 23 6 23 12" /></>,
            Geo: <><path d="M21.21 15.89A10 10 0 1 1 8 2.83" /><path d="M22 12A10 10 0 0 0 12 2v10z" /></>,
            Chart: <><path d="M12 20V10" /><path d="M18 20V4" /><path d="M6 20v-4" /></>,
            Menu: <><line x1="3" y1="12" x2="21" y2="12" /><line x1="3" y1="6" x2="21" y2="6" /><line x1="3" y1="18" x2="21" y2="18" /></>,
            X: <><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></>,
            Target: <><circle cx="12" cy="12" r="10" /><circle cx="12" cy="12" r="6" /><circle cx="12" cy="12" r="2" /></>,
            Bulb: <><path d="M9 18h6" /><path d="M10 22h4" /><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2v-2.26C17.81 13.47 19 11.38 19 9a7 7 0 0 0-7-7z" /></>,
            ArrowRight: <><line x1="5" y1="12" x2="19" y2="12" /><polyline points="12 5 19 12 12 19" /></>,
            Check: <polyline points="20 6 9 17 4 12" />,
            Scale: <><path d="M6 20h12" /><path d="M12 3v17" /><path d="M6 10l-4-4" /><path d="M18 10l4-4" /></>,
            Book: <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" />
        };

        // --- COMPONENTE DE RENDERIZADO MATEM츼TICO ---
        const MathRender = ({ content, className = "" }) => {
            const containerRef = useRef(null);

            useEffect(() => {
                if (window.MathJax && window.MathJax.typesetPromise && containerRef.current) {
                    containerRef.current.innerHTML = content;
                    window.MathJax.typesetPromise([containerRef.current])
                        .catch((err) => console.log('MathJax Error:', err));
                }
            }, [content]);

            return <div ref={containerRef} className={className} />;
        };

        // --- CONTENIDO EDUCATIVO AMPLIADO ---
        const educationalModules = [
            {
                id: "algebra",
                title: "Tratado de Traducci칩n Algebraica",
                icon: "Calc",
                color: "bg-blue-700",
                concept: "Del Lenguaje Natural al Formalismo Matem치tico",
                summary: "Bienvenido a tu tutor칤a personalizada. Aqu칤 no memorizamos f칩rmulas; analizamos la l칩gica 'oculta' del ICFES. Usaremos preguntas reales (Transporte, Divisas, Geometr칤a) para deconstruir c칩mo los dise침adores del examen intentan enga침arte con trampas sem치nticas.",
                chapters: [
                    {
                        title: "Sesi칩n 1: El Algoritmo de la Rutina (An치lisis de Procesos)",
                        content: `
                            <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-600 mb-6">
                                <h4 class="text-blue-900 m-0 font-bold">Caso de Estudio: El Sistema de Transporte (Pregunta 1)</h4>
                                <p class="text-sm text-blue-800 mt-2">Un usuario cuenta 10 tramos y 10 paradas. Calcula: $10 \\times 4\\text{min} + 30\\text{seg}$. 쯇or qu칠 falla?</p>
                            </div>
                            
                            <p>El error del paso II es sutil pero fatal: es un <strong>Error de Intervalo vs. Punto</strong>.</p>
                            
                            <h4>1. La Geometr칤a del Conteo</h4>
                            <p>Imagina tus dedos. Tienes 5 dedos, pero solo 4 espacios entre ellos. En el problema, las estaciones son "puntos" ($P$) y los tramos de viaje son "intervalos" ($I$).</p>
                            <p class="text-center text-lg my-4 font-bold">$$N_{intervalos} = N_{puntos} - 1$$</p>
                            <p>Si vas de $E_1$ a $E_{10}$, hay 10 estaciones, pero solo <strong>9 tramos</strong> de viaje. El usuario cont칩 10 tramos, a침adiendo 4 minutos fantasma a su cuenta.</p>

                            <h4>2. La Trampa de la Parada Final</h4>
                            <p>Otro error cl치sico: 쮺uentas la parada en el destino? El problema dice "sum칩 30 segundos por la parada en $E_{10}$".</p>
                            <p><strong>L칩gica ICFES:</strong> El tiempo de viaje termina cuando el bus se detiene y abre las puertas. No esperas 30 segundos *despu칠s* de llegar para decir "llegu칠". Esa 칰ltima parada NO suma tiempo al trayecto, es parte de la llegada.</p>

                            <div class="mt-6 p-4 bg-yellow-50 rounded border border-yellow-200">
                                <h5 class="font-bold text-yellow-800">游눠 Lecci칩n de Tutor칤a</h5>
                                <p class="text-sm text-yellow-900">Cuando enfrentes problemas de secuencias (postes, paradas, cortes), dibuja una versi칩n peque침a. 3 paradas tienen 3 tramos? No, tienen 2. Extrapola esa regla.</p>
                            </div>
                        `
                    },
                    {
                        title: "Sesi칩n 2: La Ilusi칩n de la Moneda (Invarianza Porcentual)",
                        content: `
                            <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-600 mb-6">
                                <h4 class="text-green-900 m-0 font-bold">Caso de Estudio: Inversi칩n D칩lares vs Pesos (Pregunta 2)</h4>
                                <p class="text-sm text-green-800 mt-2">Si ganas 3% en d칩lares, 쯚anas m치s, menos o igual en pesos (tasa constante)?</p>
                            </div>

                            <p>Tu intuici칩n te grita: "춰El d칩lar vale 2.000 veces m치s! 춰La ganancia debe ser mayor!". Tu intuici칩n se equivoca. Veamos la demostraci칩n matem치tica.</p>

                            <h4>1. El Factor de Conversi칩n ($k$)</h4>
                            <p>Definamos la tasa de cambio como $k = 2000$ COP/USD.</p>
                            <ul>
                                <li>Inversi칩n inicial en d칩lares: $D_i$</li>
                                <li>Inversi칩n inicial en pesos: $P_i = k \\cdot D_i$</li>
                            </ul>

                            <h4>2. El Crecimiento</h4>
                            <p>Si ganas un 3%, multiplicas por $1.03$.</p>
                            <ul>
                                <li>Final d칩lares: $D_f = 1.03 \\cdot D_i$</li>
                                <li>Final pesos (al convertir de vuelta): $P_f = k \\cdot D_f = k \\cdot (1.03 \\cdot D_i)$</li>
                            </ul>

                            <h4>3. C치lculo del Porcentaje en Pesos</h4>
                            <p>El porcentaje de ganancia es la raz칩n de cambio:</p>
                            <p class="text-center font-bold text-xl my-4">$$\\text{Ganancia} = \\frac{P_f}{P_i} = \\frac{k \\cdot 1.03 \\cdot D_i}{k \\cdot D_i}$$</p>
                            <p>Observa la magia: 춰La $k$ (el 2000) est치 arriba y abajo! <strong>Se cancela</strong>.</p>
                            <p class="text-center">$$Resultado = 1.03 \\to 3\\%$$</p>

                            <p><strong>Conclusi칩n:</strong> El porcentaje es una medida <em>relativa</em>. Las unidades (escalas) no lo afectan. Es un principio de invarianza.</p>
                        `
                    },
                    {
                        title: "Sesi칩n 3: La Trampa Dimensional (Escalas Cuadradas)",
                        content: `
                            <div class="bg-orange-50 p-4 rounded-lg border-l-4 border-orange-600 mb-6">
                                <h4 class="text-orange-900 m-0 font-bold">Caso de Estudio: El Portal치pices (Pregunta 7)</h4>
                                <p class="text-sm text-orange-800 mt-2">El per칤metro aumenta de 18 a 24 (raz칩n 4/3). 쮼l 치rea tambi칠n aumenta en raz칩n 4/3?</p>
                            </div>

                            <p>Este es el error m치s com칰n en geometr칤a b치sica. Confundir medidas lineales ($L$) con medidas de superficie ($L^2$).</p>

                            <h4>1. La Regla de Potencias</h4>
                            <p>Si la raz칩n de semejanza lineal es $k = \\frac{24}{18} = \\frac{4}{3}$, entonces:</p>
                            <ul>
                                <li>Raz칩n de Longitudes (Per칤metro, Lado, Altura) = $k$</li>
                                <li>Raz칩n de 츼reas (Base, Cara, Superficie) = $k^2$</li>
                                <li>Raz칩n de Vol칰menes (Capacidad) = $k^3$</li>
                            </ul>

                            <h4>2. Demostraci칩n R치pida</h4>
                            <p>Imagina un cuadrado de lado 1. 츼rea = 1. Duplica el lado a 2 ($k=2$). Nueva 츼rea = $2 \\times 2 = 4$.</p>
                            <p>El lado se multiplic칩 por 2, pero el 치rea por 4 ($2^2$).</p>
                            <p>En el problema del portal치pices, la raz칩n de las 치reas NO es $4/3$, sino $(4/3)^2 = 16/9$. La afirmaci칩n de Eli칠cer es falsa.</p>
                        `
                    },
                    {
                        title: "Sesi칩n 4: Modelado Lineal (Pendiente Negativa)",
                        content: `
                            <div class="bg-indigo-50 p-4 rounded-lg border-l-4 border-indigo-600 mb-6">
                                <h4 class="text-indigo-900 m-0 font-bold">Caso de Estudio: Temperatura vs Altitud (Pregunta 8)</h4>
                                <p class="text-sm text-indigo-800 mt-2">A 1000m hay 15춿C. Por cada 100m subidos, baja 6춿C. Hallar T a 4000m.</p>
                            </div>

                            <p>Aqu칤 traduciremos texto a una funci칩n af칤n $y = mx + b$.</p>

                            <h4>1. Identificar la Variable Independiente</h4>
                            <p>Lo que cambia libremente es la altura extra escalada. El problema pide la temperatura a 4000m, partiendo de 1000m.</p>
                            <p>El cambio de altura es $\\Delta h = 4000 - 1000$.</p>

                            <h4>2. Identificar la Tasa de Cambio (Pendiente $m$)</h4>
                            <p>Dice: "disminuye 6춿C por cada 100m".</p>
                            <p class="text-center">$$m = \\frac{-6^\\circ C}{100m}$$</p>

                            <h4>3. Construcci칩n de la Ecuaci칩n</h4>
                            <p>$$T_{final} = T_{inicial} + (\\text{tasa}) \\cdot (\\text{cambio altura})$$</p>
                            <p>$$T = 15 + \\left(\\frac{-6}{100}\\right)(4000 - 1000)$$</p>
                            
                            <p>Esta estructura $(y - y_0) = m(x - x_0)$ es la forma Punto-Pendiente. Es la herramienta m치s poderosa para problemas de variaci칩n lineal.</p>
                        `
                    },
                    {
                        title: "Sesi칩n 5: Grados de Libertad (Sistemas Indeterminados)",
                        content: `
                            <div class="bg-purple-50 p-4 rounded-lg border-l-4 border-purple-600 mb-6">
                                <h4 class="text-purple-900 m-0 font-bold">Caso de Estudio: La Trayectoria Parab칩lica (Pregunta 15)</h4>
                                <p class="text-sm text-purple-800 mt-2">Tenemos la ecuaci칩n $y = ax^2 + bx + c$ y dos puntos. 쯉e puede hallar la funci칩n?</p>
                            </div>

                            <p>Este es un problema de 치lgebra pura disfrazado de astronom칤a.</p>

                            <h4>1. Contando Inc칩gnitas</h4>
                            <p>La ecuaci칩n $y = ax^2 + bx + c$ tiene TRES coeficientes desconocidos: $a$ (apertura), $b$ (posici칩n), $c$ (intercepto).</p>

                            <h4>2. Contando Ecuaciones (Datos)</h4>
                            <p>Cada punto $(x, y)$ que te dan es una ecuaci칩n. Si te dan 2 puntos (M y N), tienes 2 ecuaciones.</p>
                            <p class="text-center font-bold text-red-600">3 Inc칩gnitas > 2 Ecuaciones $\\to$ Sistema Indeterminado</p>

                            <p>Necesitas obligatoriamente un tercer dato (otro punto, el v칠rtice, o el valor de $a$) para "bloquear" la par치bola en una 칰nica posici칩n. Con solo 2 puntos, infinitas par치bolas pueden pasar por ah칤.</p>
                        `
                    }
                ],
                tips: [
                    "N. intervalos = N. puntos - 1 (para l칤neas abiertas).",
                    "El porcentaje es adimensional: no le importa la moneda.",
                    "Raz칩n de 츼reas = (Raz칩n de Lados).",
                    "Tasa de cambio = $\\Delta y / \\Delta x$. Busca siempre el 'por cada'.",
                    "Para hallar $n$ inc칩gnitas, necesitas $n$ ecuaciones independientes."
                ]
            },
            {
                id: "variacion",
                title: "Teor칤a del Cambio y Modelado",
                icon: "Trend",
                color: "bg-emerald-700",
                concept: "C치lculo Diferencial Intuitivo",
                summary: "Todo en el examen cambia de dos formas: sumando (Lineal) o multiplicando (Exponencial). Este m칩dulo te ense침a a detectar la 'huella digital' matem치tica de cada fen칩meno en el texto.",
                chapters: [
                    {
                        title: "Cap칤tulo I: La Huella Lineal",
                        content: `<p>Si el problema dice 'aumenta 2 grados <strong>por cada</strong> metro' o 'cobra $500 <strong>por cada</strong> minuto', la relaci칩n es lineal ($y = mx + b$). La palabra clave es 'constante' o 'por cada'. En la Pregunta 8, la temperatura baja de forma constante.</p>`
                    },
                    {
                        title: "Cap칤tulo II: La Huella Exponencial",
                        content: `<p>Si el problema habla de <strong>porcentajes acumulados</strong> ('aumenta 3% cada a침o'), es exponencial. El crecimiento no es fijo, depende del tama침o actual. En la Pregunta 49, el precio no sube $X pesos, sube un % del valor anterior.</p>`
                    }
                ]
            },
            {
                id: "intro",
                title: "Filosof칤a del Examen",
                icon: "Brain",
                color: "bg-purple-800",
                concept: "Metacognici칩n",
                summary: "Entender el examen es m치s importante que memorizar datos. Aqu칤 analizamos la estructura psicol칩gica de las preguntas.",
                chapters: [
                    {
                        title: "Cap칤tulo I: Lectura Cr칤tica Matem치tica",
                        content: `<p>El 50% de los errores no son de c치lculo, son de lectura. Ignorar unidades, confundir radio con di치metro, o no ver un 'NO' en la pregunta.</p>`
                    }
                ]
            },
            {
                id: "geometria",
                title: "Geometr칤a Anal칤tica y Escalar",
                icon: "Geo",
                color: "bg-orange-600",
                concept: "Relaciones Espaciales",
                summary: "El espacio no se comporta linealmente. Las 치reas y vol칰menes tienen reglas de crecimiento explosivo que el examen adora evaluar.",
                chapters: [
                    {
                        title: "Cap칤tulo I: Ley Cuadr치tico-C칰bica",
                        content: `<p>Si duplicas el lado de un cuadrado, su 치rea se cuadruplica ($2^2=4$). Si duplicas el lado de un cubo, su volumen se octuplica ($2^3=8$). Esta es la trampa de la Pregunta 7.</p>`
                    }
                ]
            },
            {
                id: "datos",
                title: "Estad칤stica Inferencial",
                icon: "Chart",
                color: "bg-rose-700",
                concept: "Interpretaci칩n de Datos",
                summary: "La estad칤stica en el ICFES no es calcular, es interpretar qu칠 significan la media y la desviaci칩n en la vida real.",
                chapters: [
                    {
                        title: "Cap칤tulo I: Invarianza de la Dispersi칩n",
                        content: `<p>Si sumas un valor constante a todos los datos, el promedio sube, pero la dispersi칩n (desviaci칩n est치ndar) se mantiene intacta. Pregunta 24.</p>`
                    }
                ]
            }
        ];

        // --- GENERADOR DE PREGUNTAS (SIMULADOR INFINITO) ---

        const generateQuestion = (type) => {
            const r = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

            const templates = {
                // SESI칍N 1: TRANSPORTE (Intervalos vs Puntos)
                transport_intervals: () => {
                    const stops = r(6, 12);
                    const timePerSegment = r(3, 6); // minutes
                    const timePerStop = 30; // seconds

                    const segments = stops - 1;
                    const totalMinutesCalculation = segments * timePerSegment;
                    const totalSecondsCalculation = timePerStop;

                    return {
                        id: Math.random(),
                        category: "An치lisis de Algoritmos",
                        text: `Un bus recorre una ruta con ${stops} estaciones consecutivas ($E_1$ a $E_{${stops}}$). Tarda ${timePerSegment} min entre estaciones y para ${timePerStop} seg en cada estaci칩n intermedia. Un usuario estima: "Hay ${stops} estaciones, as칤 que multiplico ${stops} $\\times$ ${timePerSegment} min". 쯈u칠 error comete?`,
                        options: [
                            { id: "A", text: `Error de Intervalo: Hay ${stops} estaciones pero solo ${segments} tramos de viaje.`, correct: true },
                            { id: "B", text: `Error de Unidad: No sum칩 los tiempos de parada en segundos.` },
                            { id: "C", text: `Error de Operaci칩n: Debi칩 dividir en lugar de multiplicar.` },
                            { id: "D", text: `No hay error, el c치lculo es aproximado pero v치lido.` }
                        ],
                        explanation: `<strong>Principio de Postes e Intervalos:</strong> Si tienes $n$ puntos en l칤nea, tienes $n-1$ espacios entre ellos. De $E_1$ a $E_{${stops}}$ hay solo ${segments} tramos. Multiplicar por ${stops} a침ade un tramo inexistente.`
                    };
                },

                // SESI칍N 2: MONEDA (Invarianza)
                currency_invariance: () => {
                    const rate = r(2000, 4000);
                    const gainPercent = r(2, 10);

                    return {
                        id: Math.random(),
                        category: "Porcentajes Relativos",
                        text: `Ana invierte en Euros. La tasa es 1 EUR = ${rate} COP (constante). Su inversi칩n en Euros crece un ${gainPercent}%. Su hermano dice: "En pesos ganaste m치s del ${gainPercent}%, porque el Euro vale ${rate} veces m치s".`,
                        options: [
                            { id: "A", text: `Verdadero: La ganancia en pesos se multiplica por ${rate}.` },
                            { id: "B", text: `Falso: El porcentaje es el mismo (${gainPercent}%) sin importar la moneda.`, correct: true },
                            { id: "C", text: `Falso: En pesos gana menos porque la moneda es m치s d칠bil.` },
                            { id: "D", text: `Depende del monto inicial de la inversi칩n.` }
                        ],
                        explanation: `<strong>Invarianza:</strong> $$P_{final} = k \\cdot D_{final} = k \\cdot (1.${gainPercent} \\cdot D_{inicial})$$. La tasa $k$ multiplica tanto al inicio como al final, por lo que se cancela al calcular la proporci칩n de ganancia.`
                    };
                },

                // SESI칍N 3: ESCALAS (Cuadr치tica)
                geometry_scaling: () => {
                    const k = r(2, 4);
                    const shape = Math.random() > 0.5 ? "cuadrado" : "c칤rculo";
                    const dimName = shape === "cuadrado" ? "lado" : "radio";

                    return {
                        id: Math.random(),
                        category: "Geometr칤a Escalar",
                        text: `Se tiene un ${shape}. Si su ${dimName} aumenta ${k} veces (se multiplica por ${k}), 쯤u칠 sucede con su 치rea?`,
                        options: [
                            { id: "A", text: `El 치rea aumenta ${k} veces.`, correct: false },
                            { id: "B", text: `El 치rea aumenta ${k * 2} veces.` },
                            { id: "C", text: `El 치rea aumenta ${k * k} veces.`, correct: true },
                            { id: "D", text: `El 치rea se mantiene igual.` }
                        ],
                        explanation: `<strong>Ley Cuadr치tico-C칰bica:</strong> La relaci칩n de 치reas es el cuadrado de la relaci칩n lineal. Si $L_2 = ${k} L_1$, entonces $A_2 = (${k})^2 A_1 = ${k * k} A_1$.`
                    };
                },

                // SESI칍N 4: MODELADO (Lineal Negativo)
                function_modeling: () => {
                    const startVal = r(80, 100);
                    const slope = r(2, 5);
                    const variable = "tiempo";

                    return {
                        id: Math.random(),
                        category: "Modelado de Funciones",
                        text: `Un tanque tiene ${startVal} litros. Se abre un desag칲e y pierde ${slope} litros por minuto. 쮺u치l ecuaci칩n describe el volumen $V$ en funci칩n del tiempo $t$?`,
                        options: [
                            { id: "A", text: `$V = ${startVal} - ${slope}t$`, correct: true },
                            { id: "B", text: `$V = ${slope}t - ${startVal}$` },
                            { id: "C", text: `$V = ${startVal} + ${slope}t$` },
                            { id: "D", text: `$V = (${startVal}/${slope})t$` }
                        ],
                        explanation: `<strong>Ecuaci칩n Af칤n:</strong> Valor Inicial $b = ${startVal}$. Tasa de cambio (pendiente) $m = -${slope}$ (porque pierde). La forma es $y = b + mx \\to V = ${startVal} - ${slope}t$.`
                    };
                },

                // MEZCLA ALEATORIA DE LAS ANTERIORES PARA VARIEDAD
                algebra_classic: () => {
                    return {
                        id: Math.random(),
                        category: "L칩gica Algebraica",
                        text: `Si Juan tiene el triple de edad que Pedro ($J$ y $P$), 쯖칩mo se escribe?`,
                        options: [
                            { id: "A", text: `$J = 3P$`, correct: true },
                            { id: "B", text: `$P = 3J$` },
                            { id: "C", text: `$J = P + 3$` },
                            { id: "D", text: `$3J = P$` }
                        ],
                        explanation: "Si Juan es mayor (tiene m치s edad), para igualar la balanza debes multiplicar la edad del menor (Pedro) por 3."
                    }
                }
            };

            const keys = Object.keys(templates);
            const randomType = keys[Math.floor(Math.random() * keys.length)];
            return templates[randomType]();
        };

        // --- COMPONENTES UI (Iguales al original, estructura mantenida) ---

        const MenuButton = ({ onClick }) => (
            <button onClick={onClick} className="fixed top-4 left-4 z-50 p-3 bg-slate-900 text-white rounded-full shadow-lg hover:bg-slate-800 transition-all md:hidden">
                <Icon path={Icons.Menu} />
            </button>
        );

        const Sidebar = ({ isOpen, setView, activeView, closeSidebar }) => (
            <>
                {isOpen && <div className="fixed inset-0 bg-black/60 z-30 md:hidden fade-in" onClick={closeSidebar}></div>}
                <aside className={`fixed inset-y-0 left-0 z-40 w-80 bg-slate-900 text-slate-100 transform transition-transform duration-300 ease-in-out ${isOpen ? 'translate-x-0' : '-translate-x-full'} md:relative md:translate-x-0 flex flex-col shadow-2xl`}>
                    <div className="p-8 border-b border-slate-800">
                        <h2 className="font-black text-2xl text-white mb-2 tracking-tight">El Traductor</h2>
                        <p className="text-slate-400 text-sm font-medium">Edici칩n Libro Maestro</p>
                    </div>

                    <nav className="flex-1 overflow-y-auto p-4 space-y-3">
                        <div className="text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 ml-2 mt-2">Cap칤tulos de Estudio</div>
                        {educationalModules.map((mod) => (
                            <button
                                key={mod.id}
                                onClick={() => { setView('learn', mod.id); closeSidebar(); }}
                                className={`w-full flex items-start gap-4 px-4 py-4 rounded-xl transition-all group relative overflow-hidden ${activeView.id === mod.id && activeView.mode === 'learn' ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}
                            >
                                <div className={`mt-1 relative z-10 transition-transform group-hover:scale-110 ${activeView.id === mod.id ? 'text-white' : 'text-slate-500 group-hover:text-blue-400'}`}>
                                    <Icon path={Icons[mod.icon]} size={20} />
                                </div>
                                <div className="text-left relative z-10">
                                    <span className="block font-bold text-base">{mod.title}</span>
                                    <span className={`block text-xs mt-1 leading-snug ${activeView.id === mod.id ? 'text-blue-100' : 'text-slate-600 group-hover:text-slate-400'}`}>{mod.concept}</span>
                                </div>
                                {activeView.id === mod.id && <div className="absolute inset-0 bg-gradient-to-r from-blue-600 to-blue-500 z-0"></div>}
                            </button>
                        ))}

                        <div className="my-8 border-t border-slate-800"></div>
                        <div className="text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 ml-2">Evaluaci칩n</div>
                        <button
                            onClick={() => { setView('quiz'); closeSidebar(); }}
                            className={`w-full flex items-center gap-4 px-4 py-5 rounded-xl transition-all ${activeView.mode === 'quiz' ? 'bg-indigo-600 text-white shadow-lg' : 'bg-slate-800/50 text-slate-300 hover:bg-indigo-900/30 hover:text-white border border-slate-800'}`}
                        >
                            <Icon path={Icons.Target} className="text-indigo-400" />
                            <div className="text-left">
                                <span className="block font-bold">Simulador Infinito</span>
                                <span className="block text-xs text-slate-500 mt-1">Generaci칩n Procedural</span>
                            </div>
                        </button>
                    </nav>
                </aside>
            </>
        );

        const BookChapter = ({ title, content }) => (
            <div className="mb-12 pl-6 border-l-4 border-slate-200 hover:border-blue-600 transition-all duration-300">
                <h3 className="text-xl font-bold text-slate-900 mb-4">{title}</h3>
                <MathRender className="prose-custom" content={content} />
            </div>
        );

        const LearningView = ({ module }) => {
            return (
                <div className="w-full h-screen overflow-y-auto bg-white">
                    <div className={`${module.color} text-white p-8 md:p-16 relative overflow-hidden shadow-2xl`}>
                        <div className="absolute top-0 right-0 p-32 bg-white opacity-5 rounded-full transform translate-x-1/2 -translate-y-1/2"></div>
                        <div className="max-w-4xl mx-auto relative z-10">
                            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-black/20 text-xs font-bold uppercase tracking-widest mb-6 backdrop-blur-sm">
                                <Icon path={Icons.Book} size={14} /> M칩dulo Maestro
                            </div>
                            <h1 className="text-4xl md:text-6xl font-black mb-6 tracking-tight">{module.title}</h1>
                            <p className="text-xl md:text-2xl text-white/90 font-medium leading-relaxed max-w-2xl">{module.summary}</p>
                        </div>
                    </div>

                    <div className="max-w-4xl mx-auto p-8 md:p-16 pb-32">
                        {module.chapters ? (
                            module.chapters.map((chapter, index) => (
                                <BookChapter key={index} title={chapter.title} content={chapter.content} />
                            ))
                        ) : (
                            <div className="text-center py-20 text-slate-500">
                                Contenido en construcci칩n para este m칩dulo.
                            </div>
                        )}

                        <div className="mt-20 p-8 bg-slate-50 rounded-2xl border border-slate-200 shadow-sm">
                            <h4 className="font-bold text-slate-900 mb-6 flex items-center gap-2 text-lg">
                                <Icon path={Icons.Brain} className="text-slate-600" /> Reglas de Oro para el Examen
                            </h4>
                            <ul className="space-y-4">
                                {module.tips && module.tips.map((tip, i) => (
                                    <li key={i} className="flex gap-4 text-slate-700 items-start">
                                        <div className="mt-1 p-1 bg-green-100 rounded-full text-green-700 shrink-0">
                                            <Icon path={Icons.Check} size={14} />
                                        </div>
                                        <div className="text-base"><MathRender content={tip} /></div>
                                    </li>
                                ))}
                            </ul>
                        </div>
                    </div>
                </div>
            );
        };

        const QuizView = () => {
            const [question, setQuestion] = useState(null);
            const [selected, setSelected] = useState(null);
            const [score, setScore] = useState(0);
            const [streak, setStreak] = useState(0);

            const nextQuestion = () => {
                setQuestion(generateQuestion());
                setSelected(null);
            };

            useEffect(() => {
                nextQuestion();
            }, []);

            const handleSelect = (opt) => {
                if (selected) return;
                setSelected(opt);
                if (opt.correct) {
                    setScore(s => s + 10);
                    setStreak(s => s + 1);
                } else {
                    setStreak(0);
                }
            };

            if (!question) return <div className="flex h-screen items-center justify-center text-slate-500">Cargando simulador...</div>;

            return (
                <div className="w-full h-screen overflow-y-auto bg-slate-50 flex items-center justify-center p-4">
                    <div className="max-w-2xl w-full">
                        <div className="flex justify-between items-end mb-6 px-2">
                            <div>
                                <h2 className="text-2xl font-black text-slate-800">Simulador</h2>
                                <p className="text-slate-500 text-sm">Pr치ctica infinita (Nuevos temas incluidos)</p>
                            </div>
                            <div className="flex gap-4">
                                <div className="text-right">
                                    <span className="text-xs font-bold text-slate-400 uppercase">Puntos</span>
                                    <div className="text-xl font-black text-indigo-600">{score}</div>
                                </div>
                                <div className="text-right">
                                    <span className="text-xs font-bold text-slate-400 uppercase">Racha</span>
                                    <div className="text-xl font-black text-orange-500">{streak}</div>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden relative">
                            <div className="p-8 md:p-10">
                                <span className="inline-block px-3 py-1 bg-indigo-50 text-indigo-700 text-xs font-bold rounded-full mb-6 uppercase tracking-wide border border-indigo-100">
                                    {question.category}
                                </span>
                                <h3 className="text-xl md:text-2xl font-bold text-slate-800 mb-8 leading-relaxed">
                                    <MathRender content={question.text} />
                                </h3>

                                <div className="space-y-3">
                                    {question.options.map((opt) => (
                                        <button
                                            key={opt.id}
                                            onClick={() => handleSelect(opt)}
                                            disabled={!!selected}
                                            className={`w-full p-5 rounded-2xl text-left border-2 transition-all relative group
                                                ${selected
                                                    ? opt.correct
                                                        ? 'bg-green-50 border-green-500 text-green-900'
                                                        : opt === selected
                                                            ? 'bg-red-50 border-red-500 text-red-900'
                                                            : 'bg-slate-50 border-slate-100 text-slate-400 opacity-50'
                                                    : 'bg-white border-slate-100 hover:border-indigo-500 hover:shadow-md text-slate-700 font-medium btn-bounce'
                                                }
                                            `}
                                        >
                                            <div className="flex items-start gap-4">
                                                <span className={`font-black text-lg ${selected && opt.correct ? 'text-green-600' : 'text-slate-300 group-hover:text-indigo-500'}`}>{opt.id}</span>
                                                <span className="mt-0.5"><MathRender content={opt.text} /></span>
                                            </div>

                                            {selected && opt.correct && (
                                                <div className="absolute right-6 top-1/2 -translate-y-1/2 text-green-600 bg-white rounded-full p-1 shadow-sm">
                                                    <Icon path={Icons.Check} />
                                                </div>
                                            )}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {selected && (
                                <div className="bg-slate-900 p-8 md:p-10 text-white slide-up">
                                    <div className="flex gap-4 mb-4">
                                        <div className={`p-2 rounded-lg ${selected.correct ? 'bg-green-500' : 'bg-red-500'}`}>
                                            <Icon path={selected.correct ? Icons.Check : Icons.X} size={24} className="text-white" />
                                        </div>
                                        <div>
                                            <div className="font-bold text-lg">
                                                {selected.correct ? '춰Correcto!' : 'An치lisis del Error'}
                                            </div>
                                            <div className="text-slate-400 text-sm">Entendiendo la l칩gica del ICFES</div>
                                        </div>
                                    </div>

                                    <div className="text-slate-300 mb-8 leading-relaxed border-l-2 border-slate-700 pl-4">
                                        <MathRender content={question.explanation} />
                                    </div>

                                    <button
                                        onClick={nextQuestion}
                                        className="w-full py-4 bg-white text-slate-900 font-bold rounded-xl hover:bg-indigo-50 transition-colors flex items-center justify-center gap-2"
                                    >
                                        Siguiente Desaf칤o <Icon path={Icons.ArrowRight} />
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [sidebarOpen, setSidebarOpen] = useState(false);
            const [mode, setMode] = useState('learn'); // 'learn' or 'quiz'
            const [moduleId, setModuleId] = useState('algebra');

            const activeView = { mode, id: moduleId };
            const currentModule = educationalModules.find(m => m.id === moduleId);

            const handleSetView = (newMode, newId) => {
                setMode(newMode);
                if (newId) setModuleId(newId);
            };

            return (
                <div className="flex h-screen bg-white overflow-hidden">
                    <MenuButton onClick={() => setSidebarOpen(true)} />
                    <Sidebar
                        isOpen={sidebarOpen}
                        closeSidebar={() => setSidebarOpen(false)}
                        activeView={activeView}
                        setView={handleSetView}
                    />

                    <main className="flex-1 h-full relative">
                        {mode === 'learn' ? (
                            <LearningView module={currentModule} />
                        ) : (
                            <QuizView />
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>