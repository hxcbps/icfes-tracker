<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Traductor Matem√°tico | Saber 11 Master</title>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel para JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- MathJax Configuration (CONFIGURACI√ìN ROBUSTA) -->
    <script>
        window.MathJax = {
            loader: { load: ['[tex]/ams'] },
            tex: {
                packages: { '[+]': ['ams'] },
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            chtml: {
                scale: 1.1,
                fontURL: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2'
            },
            options: {
                enableMenu: false,
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            startup: {
                typeset: false
            }
        };
    </script>
    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        body {
            background-color: #f8fafc;
            font-family: 'Inter', system-ui, sans-serif;
        }

        mjx-container {
            outline: none !important;
        }

        .math-display {
            overflow-x: auto;
            overflow-y: hidden;
            padding: 10px 0;
        }

        .fade-in {
            animation: fadeIn 0.4s ease-out;
        }

        .slide-up {
            animation: slideUp 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 4px;
        }

        /* Typography for "Book Mode" */
        .prose-custom h3 {
            color: #1e293b;
            font-weight: 800;
            margin-top: 2.5rem;
            margin-bottom: 1rem;
            font-size: 1.4rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 0.5rem;
        }

        .prose-custom h4 {
            color: #334155;
            font-weight: 700;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            font-size: 1.15rem;
        }

        .prose-custom p {
            color: #334155;
            line-height: 1.8;
            margin-bottom: 1.2rem;
            font-size: 1.05rem;
        }

        .prose-custom strong {
            color: #0f172a;
            font-weight: 700;
        }

        .prose-custom ul {
            list-style-type: disc;
            padding-left: 1.5rem;
            margin-bottom: 1rem;
            color: #334155;
        }

        .prose-custom li {
            margin-bottom: 0.5rem;
        }

        .prose-custom ol {
            list-style-type: decimal;
            padding-left: 1.5rem;
            margin-bottom: 1rem;
            color: #334155;
        }

        .btn-bounce:active {
            transform: scale(0.98);
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONOS ---
        const Icon = ({ path, size = 24, className = "", color = "currentColor" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const Icons = {
            Brain: <path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 4.44-4z M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-4.44-4z" />,
            Calc: <path d="M4 2h16a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V4a2 2 0 0 1-2-2z M8 6h8 M16 14v4 M12 14v4 M8 14v4" />,
            Trend: <><polyline points="23 6 13.5 15.5 8.5 10.5 1 18" /><polyline points="17 6 23 6 23 12" /></>,
            Geo: <><path d="M21.21 15.89A10 10 0 1 1 8 2.83" /><path d="M22 12A10 10 0 0 0 12 2v10z" /></>,
            Chart: <><path d="M12 20V10" /><path d="M18 20V4" /><path d="M6 20v-4" /></>,
            Menu: <><line x1="3" y1="12" x2="21" y2="12" /><line x1="3" y1="6" x2="21" y2="6" /><line x1="3" y1="18" x2="21" y2="18" /></>,
            X: <><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></>,
            Target: <><circle cx="12" cy="12" r="10" /><circle cx="12" cy="12" r="6" /><circle cx="12" cy="12" r="2" /></>,
            Bulb: <><path d="M9 18h6" /><path d="M10 22h4" /><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2v-2.26C17.81 13.47 19 11.38 19 9a7 7 0 0 0-7-7z" /></>,
            ArrowRight: <><line x1="5" y1="12" x2="19" y2="12" /><polyline points="12 5 19 12 12 19" /></>,
            Check: <polyline points="20 6 9 17 4 12" />,
            Scale: <><path d="M6 20h12" /><path d="M12 3v17" /><path d="M6 10l-4-4" /><path d="M18 10l4-4" /></>,
            Book: <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" />
        };

        // --- COMPONENTE DE RENDERIZADO MATEM√ÅTICO ---
        const MathRender = ({ content, className = "" }) => {
            const containerRef = useRef(null);

            useEffect(() => {
                if (window.MathJax && window.MathJax.typesetPromise && containerRef.current) {
                    containerRef.current.innerHTML = content;
                    window.MathJax.typesetPromise([containerRef.current])
                        .catch((err) => console.log('MathJax Error:', err));
                }
            }, [content]);

            return <div ref={containerRef} className={className} />;
        };

        // --- CONTENIDO EDUCATIVO AMPLIADO ---
        const educationalModules = [
            {
                id: "aritmetica",
                title: "M√≥dulo 1: Aritm√©tica y N√∫meros Reales",
                icon: "Calc",
                color: "bg-blue-700",
                concept: "Fundamentaci√≥n Matem√°tica Rigurosa",
                summary: "Desarrollo de competencias para interpretar magnitudes, manejar sistemas de unidades y calcular variaciones proporcionales bajo l√≥gica formal.",
                chapters: [
                    {
                        title: "1. Operaciones B√°sicas: El Lenguaje del Cambio",
                        content: `
<!-- SECCI√ìN 1.1: TU CAJA DE HERRAMIENTAS (VERSI√ìN TUTOR√çA PROFUNDA) -->
                                <div class="space-y-12">
                                    
                                    <!-- INTRODUCCI√ìN: LA TEOR√çA DEL P√çXEL -->
                                    <div class="bg-gray-900 text-white p-8 rounded-2xl shadow-2xl border border-gray-700">
                                        <div class="flex items-center gap-4 mb-6 border-b border-gray-700 pb-4">
                                            <div class="p-3 bg-blue-600 rounded-lg shadow-lg shadow-blue-900/50">
                                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/></svg>
                                            </div>
                                            <div>
                                                <h4 class="font-black text-3xl tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-indigo-400">1.1 La Filosof√≠a de los N√∫meros</h4>
                                                <p class="text-gray-400 text-sm font-medium">No calcules todav√≠a. Primero, APRENDE A VER.</p>
                                            </div>
                                        </div>

                                        <p class="text-lg text-gray-300 leading-relaxed mb-8">
                                            Imagina que tienes dos tipos de gafas para ver el universo. El ICFES te va a preguntar constantemente: <span class="text-white font-bold italic">"¬øQu√© gafas llevas puestas?"</span>.
                                            Si usas las incorrectas, la calculadora te dir√° una mentira.
                                        </p>

                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                            <!-- MUNDO PIXEL (Z) -->
                                            <div class="bg-gray-800 p-6 rounded-xl border-l-4 border-emerald-500 hover:bg-gray-750 transition-colors">
                                                <strong class="text-emerald-400 text-xl block mb-2 font-mono">A. El Mundo Pixelado ($\mathbb{Z}$)</strong>
                                                <p class="text-sm text-gray-400 mb-4 h-16">
                                                    Como un videojuego antiguo. Solo puedes moverte por casillas completas. No existe el "medio personaje". 
                                                </p>
                                                <ul class="space-y-2 text-sm text-gray-300">
                                                    <li class="flex items-center gap-2">üïπÔ∏è <span class="font-bold text-white">Esencia:</span> Contar (Discreto).</li>
                                                    <li class="flex items-center gap-2">üö´ <span class="font-bold text-white">Prohibido:</span> Decimales individuales.</li>
                                                    <li class="flex items-center gap-2">üì¶ <span class="font-bold text-white">Ejemplos:</span> <span class="bg-gray-900 px-2 py-1 rounded">Personas</span> <span class="bg-gray-900 px-2 py-1 rounded">Goles</span> <span class="bg-gray-900 px-2 py-1 rounded">√Åtomos</span></li>
                                                </ul>
                                            </div>

                                            <!-- MUNDO FLUIDO (R) -->
                                            <div class="bg-gray-800 p-6 rounded-xl border-l-4 border-blue-500 hover:bg-gray-750 transition-colors">
                                                <strong class="text-blue-400 text-xl block mb-2 font-mono">B. El Mundo Fluido ($\mathbb{R}$)</strong>
                                                <p class="text-sm text-gray-400 mb-4 h-16">
                                                    Como el agua. Puedes servir un vaso, medio vaso, o $0.137$ vasos. Siempre hay espacio en medio.
                                                </p>
                                                <ul class="space-y-2 text-sm text-gray-300">
                                                    <li class="flex items-center gap-2">üíß <span class="font-bold text-white">Esencia:</span> Medir (Continuo).</li>
                                                    <li class="flex items-center gap-2">‚úÖ <span class="font-bold text-white">Permitido:</span> Infinita precisi√≥n.</li>
                                                    <li class="flex items-center gap-2">üìè <span class="font-bold text-white">Ejemplos:</span> <span class="bg-gray-900 px-2 py-1 rounded">Tiempo</span> <span class="bg-gray-900 px-2 py-1 rounded">Dinero*</span> <span class="bg-gray-900 px-2 py-1 rounded">Voltaje</span></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- CASO DE ESTUDIO: EL DILEMA LOG√çSTICO -->
                                    <div class="relative pl-8 md:pl-12 border-l-2 border-indigo-200 py-4">
                                        <span class="absolute -left-4 top-0 bg-indigo-600 text-white rounded-full p-2 shadow-lg">
                                            <Icon path={Icons.Brain} size={20} />
                                        </span>
                                        
                                        <h4 class="font-bold text-indigo-900 text-2xl mb-4">Caso de Estudio: El Dilema Log√≠stico</h4>
                                        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 mb-6">
                                            <div class="flex flex-col md:flex-row gap-6 items-start">
                                                <div class="flex-1">
                                                    <p class="text-slate-700 italic text-lg mb-4">
                                                        "Necesitas transportar a <strong>48 estudiantes</strong> a una excursi√≥n. Cada bus escolar tiene capacidad m√°xima para <strong>10 pasajeros</strong>. ¬øCu√°ntos buses contratas?"
                                                    </p>
                                                    
                                                    <div class="bg-red-50 p-4 rounded-lg border-l-4 border-red-500 mb-4">
                                                        <strong class="text-red-900 block mb-1">El Error del Novato (Calculadora Ciega)</strong>
                                                        <p class="font-mono text-red-700 text-lg">$$ N = \frac{48}{10} = 4.8 \text{ buses} $$</p>
                                                        <p class="text-sm text-red-800 mt-2">
                                                            El estudiante responde: <span class="font-bold">"4.8 buses"</span>. <br>
                                                            O peor, redondea matem√°ticamente: <span class="font-bold">"5 buses"</span> (pero sin saber por qu√©).
                                                            O a√∫n peor, redondea hacia abajo: <span class="font-bold">"4 buses"</span>.
                                                        </p>
                                                    </div>
                                                </div>
                                                
                                                <div class="flex-1 bg-slate-50 p-5 rounded-xl border border-slate-200">
                                                    <strong class="text-indigo-900 block mb-3 text-lg">La Intervenci√≥n del Tutor</strong>
                                                    <div class="space-y-3 text-sm text-slate-700">
                                                        <p>‚Äî <strong>Tutor:</strong> Detente. Dibuja mentalmente 0.8 buses. ¬øQu√© es? ¬øUn bus sin techo? ¬øSolo las llantas?</p>
                                                        <p>‚Äî <strong>Estudiante:</strong> No existe. Tienen que ser enteros.</p>
                                                        <p>‚Äî <strong>Tutor:</strong> Exacto. Estamos en el <span class="font-bold text-emerald-600">Mundo Pixelado ($\mathbb{Z}$)</span>. Ahora, decide el redondeo:</p>
                                                        <ul class="list-disc pl-5 space-y-2 mt-2">
                                                            <li><span class="font-bold text-red-600">Opci√≥n A (4 buses):</span> Llevas 40 estudiantes. Dejas a 8 tirados en la calle llorando. üò≠</li>
                                                            <li><span class="font-bold text-green-600">Opci√≥n B (5 buses):</span> Llevas 50 cupos. Sobran 2 sillas vac√≠as. Todos viajan. üòé</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="mt-4 p-4 bg-indigo-100 rounded text-indigo-900 text-sm font-medium text-center">
                                                <span class="block text-xl mb-1">üí° COMENTARIO ICFES</span>
                                                En problemas de CAPACIDAD, el decimal siempre obliga a un nuevo entero completo. Esto se llama <strong class="underline decoration-wavy decoration-indigo-400">Funci√≥n Techo (Ceiling)</strong>.
                                            </div>
                                        </div>
                                    </div>

                                    <!-- LA PARADOJA DEL ESTAD√çSTICO -->
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                        <div class="col-span-1 md:col-span-1 bg-amber-50 p-6 rounded-xl border border-amber-100 flex flex-col justify-center text-center">
                                            <div class="text-4xl mb-2">üë∂‚ùì</div>
                                            <h5 class="font-bold text-amber-900 text-lg leading-tight">La Paradoja de los<br>2.5 Hijos</h5>
                                        </div>
                                        <div class="col-span-1 md:col-span-2">
                                            <h5 class="font-bold text-slate-800 text-lg mb-2">Si los hijos son Enteros ($\mathbb{Z}$), ¬øpor qu√© las estad√≠sticas dan decimales?</h5>
                                            <p class="text-slate-600 mb-4 leading-relaxed">
                                                Ah√≠ est√° la trampa. Un hijo individual es un P√≠xel (Entero). Pero el <strong>Promedio de una Poblaci√≥n</strong> se convierte en un Fluido (Real).
                                            </p>
                                            <div class="bg-white p-4 border-l-4 border-amber-400 shadow-sm">
                                                <p class="text-sm font-mono text-slate-600">
                                                    Familia A: 2 hijos<br>
                                                    Familia B: 3 hijos<br>
                                                    Promedio = $\frac{2+3}{2} = 2.5$
                                                </p>
                                                <p class="text-xs text-slate-500 mt-2 italic">
                                                    El "2.5" es una propiedad matem√°tica del grupo, no una realidad biol√≥gica de una familia. El ICFES te pondr√° trampas preguntando sobre individuos bas√°ndose en el promedio.
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- EL GUANTELETE DEL TUTOR (DRILLS) -->
                                    <div class="bg-slate-50 p-8 rounded-3xl border border-slate-200">
                                        <h4 class="font-bold text-slate-900 text-center text-2xl mb-6">ü•ä El Guantelete del Tutor</h4>
                                        <p class="text-center text-slate-500 mb-8 max-w-lg mx-auto">
                                            Entrena tu ojo cl√≠nico. Antes de calcular, clasifica.
                                            <br>¬øP√≠xel (Z) o Fluido (R)?
                                        </p>

                                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
                                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
                                            <!-- ITEM 1 -->
                                            <div class="bg-white p-4 rounded-xl shadow-sm text-center group hover:-translate-y-1 transition-transform border border-slate-100">
                                                <span class="block text-xs text-slate-400 font-bold uppercase mb-2">√çtem 1</span>
                                                <strong class="block text-slate-800 text-lg mb-2">Pasos al Caminar</strong>
                                                <div class="opacity-40 group-hover:opacity-100 transition-opacity">
                                                    <span class="inline-block px-3 py-1 rounded-full text-white font-bold text-xs bg-emerald-500">Z</span>
                                                    <p class="text-xs text-slate-500 mt-1">Discreto</p>
                                                </div>
                                            </div>

                                            <!-- ITEM 2 -->
                                            <div class="bg-white p-4 rounded-xl shadow-sm text-center group hover:-translate-y-1 transition-transform border border-slate-100">
                                                <span class="block text-xs text-slate-400 font-bold uppercase mb-2">√çtem 2</span>
                                                <strong class="block text-slate-800 text-lg mb-2">Distancia Recorrida</strong>
                                                <div class="opacity-40 group-hover:opacity-100 transition-opacity">
                                                    <span class="inline-block px-3 py-1 rounded-full text-white font-bold text-xs bg-blue-500">R</span>
                                                    <p class="text-xs text-slate-500 mt-1">Continuo</p>
                                                </div>
                                            </div>

                                            <!-- ITEM 3 -->
                                            <div class="bg-white p-4 rounded-xl shadow-sm text-center group hover:-translate-y-1 transition-transform border border-slate-100">
                                                <span class="block text-xs text-slate-400 font-bold uppercase mb-2">√çtem 3</span>
                                                <strong class="block text-slate-800 text-lg mb-2">Dinero en Efectivo</strong>
                                                <div class="opacity-40 group-hover:opacity-100 transition-opacity">
                                                    <span class="inline-block px-3 py-1 rounded-full text-white font-bold text-xs bg-emerald-500">Z*</span>
                                                    <p class="text-xs text-slate-500 mt-1">M√≠nima moneda</p>
                                                </div>
                                            </div>

                                            <!-- ITEM 4 -->
                                            <div class="bg-white p-4 rounded-xl shadow-sm text-center group hover:-translate-y-1 transition-transform border border-slate-100">
                                                <span class="block text-xs text-slate-400 font-bold uppercase mb-2">√çtem 4</span>
                                                <strong class="block text-slate-800 text-lg mb-2">Dinero Digital</strong>
                                                <div class="opacity-40 group-hover:opacity-100 transition-opacity">
                                                    <span class="inline-block px-3 py-1 rounded-full text-white font-bold text-xs bg-blue-500">R</span>
                                                    <p class="text-xs text-slate-500 mt-1">Centavos/Fracciones</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- PAUSA METACOGNITIVA -->
                                    <div className="w-full bg-slate-200 h-px my-4"></div>
                                    <div className="bg-gradient-to-br from-indigo-900 to-slate-900 text-white p-6 rounded-xl flex items-center gap-6 shadow-xl">
                                        <div className="text-5xl animate-pulse">üß†</div>
                                        <div>
                                            <strong className="block text-xl text-indigo-300 font-bold mb-1">Pausa Metacognitiva</strong>
                                            <p className="text-indigo-100/80 text-sm italic">
                                                Cierra los ojos un segundo. Imagina el problema f√≠sico antes de buscar la f√≥rmula. <br>
                                                "Si la respuesta me da 3.8 perros... ¬øqu√© hago?"
                                            </p>
                                        </div>
                                    </div>

                                </div>

                                <hr class="border-slate-200">

                                <!-- SUMA Y RESTA -->
                                <div>
                                    <h3 class="text-xl font-bold text-slate-800 mb-4">1.2 La L√≥gica de la Adici√≥n: Naturaleza Id√©ntica</h3>
                                    <p class="mb-4">
                                        La suma ($+$) y resta ($-$) son operaciones de <strong>Acumulaci√≥n</strong>. 
                                        La regla dorada, que el ICFES castiga si ignoras, es la <strong>Consistencia Dimensional</strong>.
                                    </p>
                                    
                                    <div class="bg-red-50 p-5 rounded-lg border border-red-100 mb-6">
                                        <strong class="text-red-900 flex items-center gap-2">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                                            La Trampa de los No-Iguales
                                        </strong>
                                        <p class="text-sm text-red-800 mt-2">
                                            "Un auto viaja a 50 km/h y recorre 100 km. ¬øCu√°nto suma?"
                                            <br>
                                            <span class="font-mono bg-white/50 px-2 rounded ml-1">50 + 100 = 150</span> 
                                            <span class="font-bold ml-2">¬°ERROR FATAL!</span>
                                        </p>
                                        <p class="text-sm mt-2 text-red-700 italic">
                                            Jam√°s puedes sumar una Tasa (Velocidad) con una Magnitud (Distancia). Es como sumar "Peras + Miedo".
                                        </p>
                                    </div>
                                </div>

                                <!-- MULTIPLICACION -->
                                <div>
                                    <h3 class="text-xl font-bold text-slate-800 mb-4">1.3 Multiplicaci√≥n: El Arte de Escalar</h3>
                                    <p class="mb-4">
                                        Multiplicar no es "sumar r√°pido". Es <strong>Cambiar de Dimensi√≥n</strong> o <strong>Escalar</strong>.
                                        Cuando multiplicas $A \\times B$, creas una nueva entidad $C$ que hereda propiedades de ambos.
                                    </p>

                                    <div class="overflow-x-auto">
                                        <table class="w-full text-sm text-left border rounded-lg overflow-hidden">
                                            <thead class="bg-slate-100 text-slate-900 font-bold">
                                                <tr>
                                                    <th class="p-3">Operaci√≥n</th>
                                                    <th class="p-3">Interpretaci√≥n F√≠sica</th>
                                                    <th class="p-3">Ejemplo ICFES</th>
                                                </tr>
                                            </thead>
                                            <tbody class="divide-y divide-slate-200">
                                                <tr>
                                                    <td class="p-3 font-mono">$$ \\text{Valor} \\times \\text{Cantidad} $$</td>
                                                    <td class="p-3">Totalizaci√≥n (Costo Total)</td>
                                                    <td class="p-3">$2.500 \\frac{\\text{pesos}}{\\text{manzana}} \\times 5 \\text{ manzanas} = 12.500 \\text{ pesos}$</td>
                                                </tr>
                                                <tr>
                                                    <td class="p-3 font-mono">$$ \\text{Largo} \\times \\text{Ancho} $$</td>
                                                    <td class="p-3">Creaci√≥n de Superficie (√Årea)</td>
                                                    <td class="p-3">$3 \\text{ m} \\times 4 \\text{ m} = 12 \\mathbf{m^2}$ (Nueva dimensi√≥n)</td>
                                                </tr>
                                                <tr>
                                                    <td class="p-3 font-mono">$$ \\text{Tasa} \\times \\text{Tiempo} $$</td>
                                                    <td class="p-3">Transformaci√≥n</td>
                                                    <td class="p-3">$80 \\frac{\\text{km}}{\\text{h}} \\times 2 \\text{ h} = 160 \\text{ km}$ (Cancela horas)</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        `
                    },
                    {
                        title: "2. Mentalidad Fraccionaria: Porcentajes Modernos",
                        content: `
                            <div class="space-y-8 text-slate-700 leading-relaxed">
                                
                                <!-- CONCEPTO DE FACTOR -->
                                <div>
                                    <div class="bg-emerald-50 border-l-4 border-emerald-500 p-6 rounded-r mb-6">
                                        <strong class="text-emerald-900 text-lg block mb-2">El Secreto del "Factor Decimal"</strong>
                                        <p class="text-emerald-800">
                                            Olv√≠date de la "Regla de Tres" b√°sica para porcentajes. Los profesionales usan <strong>Multiplicadores</strong>.
                                            Un porcentaje es simplemente una fracci√≥n de 1.
                                        </p>
                                    </div>

                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                                        <div>
                                            <h4 class="font-bold text-slate-800 mb-2">Definici√≥n Formal</h4>
                                            <p class="text-sm mb-4">
                                                El s√≠mbolo $\%$ es literalmente un operador que significa "dividir por 100".
                                            </p>
                                            <div class="bg-slate-800 text-white p-4 rounded text-center font-mono text-xl mb-4">
                                                $$ x\\% = \\frac{x}{100} = 0.0x $$
                                            </div>
                                            <p class="text-xs text-slate-500">Ejemplo: $19\\% = 0.19$</p>
                                        </div>
                                        
                                        <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                                            <h4 class="font-bold text-slate-800 mb-3 border-b pb-2">Caja de Herramientas de Descuentos</h4>
                                            
                                            <div class="space-y-4">
                                                <div>
                                                    <strong class="text-green-700 text-sm">AUMENTAR (IVA, Intereses)</strong>
                                                    <p class="text-xs text-slate-600 mb-1">Multiplica por $(1 + \\text{tasa})$</p>
                                                    <div class="font-mono text-sm bg-green-50 p-2 rounded">
                                                        $$ \\text{Valor} \\times 1.19 $$
                                                        <span class="text-gray-400 block text-xs mt-1">// Aumenta 19% de un golpe</span>
                                                    </div>
                                                </div>

                                                <div>
                                                    <strong class="text-red-700 text-sm">DISMINUIR (Descuentos, P√©rdidas)</strong>
                                                    <p class="text-xs text-slate-600 mb-1">Multiplica por $(1 - \\text{tasa})$</p>
                                                    <div class="font-mono text-sm bg-red-50 p-2 rounded">
                                                        $$ \\text{Valor} \\times 0.70 $$
                                                        <span class="text-gray-400 block text-xs mt-1">// Te queda el 70% (Descontaste 30%)</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <hr class="border-slate-200">

                                <!-- INVARIANZA -->
                                <div>
                                    <h3 class="text-xl font-bold text-slate-800 mb-4">2.2 El Principio de Invarianza (Pregunta Arquetipo 14)</h3>
                                    <p class="mb-4 text-sm">
                                        Una trampa cl√°sica del ICFES es confundirte cambiando las unidades (D√≥lares a Pesos, Metros a Cent√≠metros).
                                        <br><strong>TEOREMA:</strong> El porcentaje es una relaci√≥n adimensional. <em>No tiene unidades.</em>
                                    </p>

                                    <div class="bg-amber-50 p-5 rounded-lg border border-amber-200">
                                        <strong class="text-amber-900 block mb-2">Ejemplo Resuelto: "El Viajero Confundido"</strong>
                                        <p class="text-sm text-amber-800 mb-3 leading-relaxed">
                                            <em>Situaci√≥n:</em> Compras una camisa en EE.UU. por $100 USD y la vendes por $120 USD. Ganaste el 20%.
                                            <br>Si el d√≥lar est√° a $4.000 COP... ¬øTu porcentaje de ganancia en pesos es mayor, menor o igual?
                                        </p>
                                        
                                        <div class="bg-white p-3 rounded border border-amber-100 mb-3">
                                            <p class="text-xs font-mono text-slate-500 mb-1">C√°lculo en Pesos:</p>
                                            <ul class="text-sm space-y-1 ml-4 list-disc text-slate-700">
                                                <li>Costo: $100 \\times 4000 = 400.000$ COP</li>
                                                <li>Venta: $120 \\times 4000 = 480.000$ COP</li>
                                                <li>Ganancia: $80.000$ COP</li>
                                                <li>Relaci√≥n: $\\frac{80.000}{400.000} = 0.20 = \\mathbf{20\\%}$</li>
                                            </ul>
                                        </div>

                                        <p class="text-sm font-bold text-amber-900">
                                            Conclusi√≥n: El "zoom" de la moneda (x4000) afecta a ambos lados de la fracci√≥n y se cancela. El % es Invariante.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        `
                    },
                    {
                        title: "3. Razones y Proporciones: F√≠sica de la Comparaci√≥n",
                        content: `
                            <div class="space-y-8 text-slate-700 leading-relaxed">
                                
                                <!-- COSTO BENEFICIO -->
                                <div>
                                    <h3 class="text-xl font-bold text-slate-800 mb-4">3.1 An√°lisis Costo-Beneficio (La F√≥rmula Maestra)</h3>
                                    <p class="mb-4">
                                        En la vida y en el examen, a menudo debes elegir "la mejor opci√≥n". No siempre lo m√°s barato es lo mejor.
                                        Necesitamos normalizar para comparar.
                                    </p>

                                    <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-indigo-600 mb-6">
                                        <div class="text-center">
                                            <strong class="text-indigo-900 text-lg">La Tasa de Eficiencia ($\eta$)</strong>
                                            <div class="my-4 text-2xl font-mono text-slate-800">
                                                $$ \eta = \frac{\text{Beneficio}}{\text{Costo}} $$
                                            </div>
                                            <p class="text-sm text-slate-500 italic">
                                                "Cu√°ntas unidades de bondad recibo por cada peso que pago"
                                            </p>
                                        </div>
                                    </div>

                                    <div class="space-y-4">
                                        <strong class="block text-slate-800">Ejemplo Pr√°ctico (Pregunta Tipo 9):</strong>
                                        <div class="grid grid-cols-2 gap-4 text-sm">
                                            <div class="p-3 bg-red-50 rounded border border-red-100">
                                                <strong class="text-red-900 block">Opci√≥n A (Paquete Chico)</strong>
                                                <ul class="mt-2 space-y-1">
                                                    <li>200 gramos</li>
                                                    <li>$5.000 pesos</li>
                                                    <li class="font-mono text-red-700 mt-2">$\frac{200}{5000} = 0.04 \text{ g/\$}$</li>
                                                </ul>
                                            </div>
                                            <div class="p-3 bg-green-50 rounded border border-green-100">
                                                <strong class="text-green-900 block">Opci√≥n B (Paquete Grande)</strong>
                                                <ul class="mt-2 space-y-1">
                                                    <li>500 gramos</li>
                                                    <li>$10.000 pesos</li>
                                                    <li class="font-mono text-green-700 mt-2">$\frac{500}{10000} = 0.05 \text{ g/\$}$</li>
                                                </ul>
                                            </div>
                                        </div>
                                        <p class="text-sm">
                                            <strong>An√°lisis:</strong> Aunque pagas m√°s en B, recibes m√°s gramos por cada peso ($0.05 > 0.04$). B es m√°s eficiente.
                                        </p>
                                    </div>
                                </div>

                                <hr class="border-slate-200">

                                <!-- REGLA DE TRES -->
                                <div>
                                    <h3 class="text-xl font-bold text-slate-800 mb-4">3.2 Regla de Tres: El Check de L√≥gica</h3>
                                    <p class="mb-4">
                                        Multitudes de estudiantes fallan por aplicar "multiplicar en cruz" a todo.
                                        Antes de operar, debes diagnosticar el tipo de relaci√≥n.
                                    </p>

                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div class="bg-white p-4 rounded border-l-4 border-blue-400 shadow-sm">
                                            <strong class="text-blue-900 block mb-2">Relaci√≥n DIRECTA ($\div$)</strong>
                                            <p class="text-xs text-slate-600 mb-2">Si uno sube, el otro sube.</p>
                                            <ul class="text-sm list-disc pl-4 space-y-1 mb-3">
                                                <li>Comprar Pan (M√°s pan $\to$ M√°s costo)</li>
                                                <li>Distancia (M√°s tiempo $\to$ M√°s lejos)</li>
                                            </ul>
                                            <div class="bg-blue-50 p-2 rounded text-center text-xs font-mono font-bold text-blue-800">
                                                $$ \frac{A}{B} = \text{Constante} $$
                                            </div>
                                        </div>

                                        <div class="bg-white p-4 rounded border-l-4 border-orange-400 shadow-sm">
                                            <strong class="text-orange-900 block mb-2">Relaci√≥n INVERSA ($\times$)</strong>
                                            <p class="text-xs text-slate-600 mb-2">Si uno sube, el otro baja.</p>
                                            <ul class="text-sm list-disc pl-4 space-y-1 mb-3">
                                                <li>Obreros (M√°s gente $\to$ Menos tiempo)</li>
                                                <li>Velocidad (M√°s r√°pido $\to$ Menos tiempo)</li>
                                            </ul>
                                            <div class="bg-orange-50 p-2 rounded text-center text-xs font-mono font-bold text-orange-800">
                                                $$ A \times B = \text{Constante} $$
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `
                    },
                    {
                        title: "4. Notaci√≥n Cient√≠fica: La Escala del Universo",
                        content: `
                            <div class="space-y-8 text-slate-700 leading-relaxed">
                                
                                <!-- EL ZOOM -->
                                <div>
                                    <h3 class="text-xl font-bold text-slate-800 mb-4">4.1 El "Zoom" Matem√°tico</h3>
                                    <p class="mb-4">
                                        La notaci√≥n cient√≠fica no es solo "mover comas". Es una forma de expresar √≥rdenes de magnitud.
                                        Imagina una c√°mara:
                                    </p>

                                    <div class="bg-slate-900 text-white p-6 rounded-xl mb-6 relative overflow-hidden">
                                        <div class="absolute top-0 right-0 p-4 opacity-10 text-9xl font-bold">10‚Åø</div>
                                        
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 relative z-10">
                                            <div>
                                                <strong class="text-blue-400 block text-lg mb-2">Zoom OUT ($n > 0$)</strong>
                                                <p class="text-sm text-slate-300 mb-2">
                                                    Cuando nos alejamos para ver galaxias. N√∫meros gigantes.
                                                </p>
                                                <div class="font-mono text-xl text-white">
                                                    $$ 3 \times 10^8 $$
                                                    <span class="text-xs text-blue-400 block mt-1">(Velocidad Luz: 300,000,000 m/s)</span>
                                                </div>
                                            </div>

                                            <div>
                                                <strong class="text-green-400 block text-lg mb-2">Zoom IN ($n < 0$)</strong>
                                                <p class="text-sm text-slate-300 mb-2">
                                                    Cuando nos acercamos para ver √°tomos. N√∫meros diminutos.
                                                </p>
                                                <div class="font-mono text-xl text-white">
                                                    $$ 1.6 \times 10^{-19} $$
                                                    <span class="text-xs text-green-400 block mt-1">(Carga Electr√≥n: 0.00...16 C)</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- OPERACIONES -->
                                <div>
                                    <h3 class="text-xl font-bold text-slate-800 mb-4">4.2 Operar en el Espacio</h3>
                                    <p class="mb-4">
                                        Para operar, debes respetar la jerarqu√≠a.
                                    </p>

                                    <div class="space-y-4">
                                        <div class="bg-indigo-50 p-4 rounded border-l-4 border-indigo-400">
                                            <strong class="text-indigo-900 text-sm block mb-1">MULTIPLICACI√ìN (F√°cil)</strong>
                                            <p class="text-xs text-slate-600 mb-2">
                                                Multiplica los coeficientes y <strong>SUMA</strong> los niveles de zoom.
                                            </p>
                                            <div class="font-mono bg-white px-2 py-1 rounded inline-block text-sm">
                                                $(2 \times 10^3) \cdot (3 \times 10^5) = 6 \times 10^8$
                                            </div>
                                        </div>

                                        <div class="bg-red-50 p-4 rounded border-l-4 border-red-400">
                                            <strong class="text-red-900 text-sm block mb-1">SUMA (Cuidado - Pregunta 41)</strong>
                                            <p class="text-xs text-slate-600 mb-2">
                                                Solo puedes sumar si tienes el <strong>mismo nivel de zoom</strong>.
                                                No puedes sumar manzanas ($10^3$) con galaxias ($10^6$).
                                            </p>
                                            <div class="font-mono bg-white px-2 py-1 rounded block text-sm mb-1">
                                                ¬ø $3 \times 10^4 + 2 \times 10^3$ ?
                                            </div>
                                            <p class="text-xs text-red-800 mt-1">
                                                Paso 1: Convertir al mismo exponente.<br>
                                                $30 \times 10^3 + 2 \times 10^3 = \mathbf{32 \times 10^3} = 3.2 \times 10^4$
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `
                    },
                    {
                        title: "5. Aplicaciones: Finanzas y Conjuntos",
                        content: `
                            <div class="space-y-6 text-slate-700">
                                <div>
                                    <h4 class="font-bold text-slate-800 mb-3">1.17 Matem√°tica Financiera</h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                        <div class="border p-3 rounded hover:bg-slate-50 transition">
                                            <strong class="text-blue-700 block mb-1">Inter√©s Simple (Lineal)</strong>
                                            <p class="mb-2 text-xs">Solo gana sobre capital inicial.</p>
                                            <div class="font-mono text-center bg-white p-1 border">$$ I = C \\cdot i \\cdot t $$</div>
                                        </div>
                                        <div class="border p-3 rounded hover:bg-slate-50 transition">
                                            <strong class="text-purple-700 block mb-1">Inter√©s Compuesto (Exp)</strong>
                                            <p class="mb-2 text-xs">Inter√©s genera inter√©s (Capitalizaci√≥n).</p>
                                            <div class="font-mono text-center bg-white p-1 border">$$ V_f = C(1+i)^t $$</div>
                                        </div>
                                    </div>
                                    <p class="text-xs text-slate-500 mt-2 italic">Nota: El tiempo en compuesto es un exponente, no un multiplicador.</p>
                                </div>

                                <hr class="border-slate-200 my-4">

                                <div>
                                    <h4 class="font-bold text-slate-800 mb-2">1.18 Teor√≠a de Conjuntos</h4>
                                    <p class="text-sm mb-2">Principio de Inclusi√≥n-Exclusi√≥n para evitar el conteo doble.</p>
                                    <div class="bg-slate-800 text-white p-3 rounded text-center text-sm font-mono mb-2">
                                        $$ n(A \\cup B) = n(A) + n(B) - n(A \\cap B) $$
                                    </div>
                                    <p class="text-sm">Al sumar los conjuntos individuales, se suma la intersecci√≥n dos veces. Se debe restar esa duplicidad.</p>
                                </div>

                                <div>
                                    <h4 class="font-bold text-slate-800 mt-4 mb-2">1.19 Conversi√≥n en Cadena</h4>
                                    <p class="text-sm">Multiplicar por fracciones unitarias para cancelar unidades.</p>
                                    <div class="font-mono text-xs bg-slate-100 p-2 rounded">
                                        $$ 90 \\frac{km}{h} \\times \\frac{1000m}{1km} \\times \\frac{1h}{3600s} = 25 m/s $$
                                    </div>
                                </div>
                            </div>
                        `
                    }
                ],
                tips: [
                    "Verifica siempre la consistencia dimensional ($km + km$, no $km + horas$).",
                    "En inecuaciones, voltea el signo si multiplicas por negativos.",
                    "El inter√©s compuesto es exponencial; el simple es lineal.",
                    "log(A*B) es la suma de logaritmos, no el logaritmo de la suma."
                ]
            },
            {
                id: "variacion",
                title: "Teor√≠a del Cambio y Modelado",
                icon: "Trend",
                color: "bg-emerald-700",
                concept: "C√°lculo Diferencial Intuitivo",
                summary: "Todo en el examen cambia de dos formas: sumando (Lineal) o multiplicando (Exponencial). Este m√≥dulo te ense√±a a detectar la 'huella digital' matem√°tica de cada fen√≥meno en el texto.",
                chapters: [
                    {
                        title: "Cap√≠tulo I: La Huella Lineal",
                        content: `<p>Si el problema dice 'aumenta 2 grados <strong>por cada</strong> metro' o 'cobra $500 <strong>por cada</strong> minuto', la relaci√≥n es lineal ($y = mx + b$). La palabra clave es 'constante' o 'por cada'. En la Pregunta 8, la temperatura baja de forma constante.</p>`
                    },
                    {
                        title: "Cap√≠tulo II: La Huella Exponencial",
                        content: `<p>Si el problema habla de <strong>porcentajes acumulados</strong> ('aumenta 3% cada a√±o'), es exponencial. El crecimiento no es fijo, depende del tama√±o actual. En la Pregunta 49, el precio no sube $X pesos, sube un % del valor anterior.</p>`
                    }
                ]
            },
            {
                id: "intro",
                title: "Filosof√≠a del Examen",
                icon: "Brain",
                color: "bg-purple-800",
                concept: "Metacognici√≥n",
                summary: "Entender el examen es m√°s importante que memorizar datos. Aqu√≠ analizamos la estructura psicol√≥gica de las preguntas.",
                chapters: [
                    {
                        title: "Cap√≠tulo I: Lectura Cr√≠tica Matem√°tica",
                        content: `<p>El 50% de los errores no son de c√°lculo, son de lectura. Ignorar unidades, confundir radio con di√°metro, o no ver un 'NO' en la pregunta.</p>`
                    }
                ]
            },
            {
                id: "geometria",
                title: "Geometr√≠a Anal√≠tica y Escalar",
                icon: "Geo",
                color: "bg-orange-600",
                concept: "Relaciones Espaciales",
                summary: "El espacio no se comporta linealmente. Las √°reas y vol√∫menes tienen reglas de crecimiento explosivo que el examen adora evaluar.",
                chapters: [
                    {
                        title: "Cap√≠tulo I: Ley Cuadr√°tico-C√∫bica",
                        content: `<p>Si duplicas el lado de un cuadrado, su √°rea se cuadruplica ($2^2=4$). Si duplicas el lado de un cubo, su volumen se octuplica ($2^3=8$). Esta es la trampa de la Pregunta 7.</p>`
                    }
                ]
            },
            {
                id: "datos",
                title: "Estad√≠stica Inferencial",
                icon: "Chart",
                color: "bg-rose-700",
                concept: "Interpretaci√≥n de Datos",
                summary: "La estad√≠stica en el ICFES no es calcular, es interpretar qu√© significan la media y la desviaci√≥n en la vida real.",
                chapters: [
                    {
                        title: "Cap√≠tulo I: Invarianza de la Dispersi√≥n",
                        content: `<p>Si sumas un valor constante a todos los datos, el promedio sube, pero la dispersi√≥n (desviaci√≥n est√°ndar) se mantiene intacta. Pregunta 24.</p>`
                    }
                ]
            }
        ];

        // --- GENERADOR DE PREGUNTAS (SIMULADOR INFINITO) ---

        const generateQuestion = (moduleId = 'aritmetica') => {
            const r = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
            const rf = (min, max) => (Math.random() * (max - min) + min).toFixed(2);

            // Plantillas Espec√≠ficas para el M√≥dulo 1: Aritm√©tica Rigurosa
            const aritmeticaTemplates = {

                // ARCHETYPE 1: ENTEROS VS REALES (Herramienta Correcta)
                integer_context: () => {
                    const items = ["Estudiantes", "Buses", "Goles", "Sillas"];
                    const continuous = ["Metros", "Litros", "Horas", "Kilos"];

                    const isDiscrete = Math.random() > 0.5;
                    const item = isDiscrete ? items[r(0, items.length - 1)] : continuous[r(0, continuous.length - 1)];
                    const val = r(10, 20);
                    const decimal = r(1, 9);
                    const result = `${val}.${decimal}`;

                    return {
                        id: Math.random(),
                        category: "Naturaleza de los N√∫meros",
                        text: `Un modelo matem√°tico calcula la cantidad de <strong>${item}</strong> necesarios para un proyecto y arroja como resultado <strong>${result}</strong>. ¬øEs este resultado v√°lido en el contexto del ICFES?`,
                        options: [
                            { id: "A", text: `S√≠, es un resultado matem√°tico preciso.` },
                            { id: "B", text: isDiscrete ? `No, porque ${item} pertenece al conjunto Entero ($Z$), no admite decimales.` : `No, porque ${item} requiere mayor precisi√≥n.`, correct: isDiscrete },
                            { id: "C", text: isDiscrete ? `S√≠, simplemente se aproxima al entero m√°s cercano.` : `S√≠, porque ${item} es una variable continua ($R$).`, correct: !isDiscrete },
                            { id: "D", text: `Depende de la calculadora usada.` }
                        ],
                        explanation: isDiscrete
                            ? `<strong>Conjunto Incorrecto:</strong> Los ${item} son unidades discretas (se cuentan, no se miden). Deben pertenecer a $\\mathbb{Z}$. Un resultado como ${result} indica un error de modelado.`
                            : `<strong>Conjunto Correcto:</strong> Los ${item} son magnitudes continuas (se miden). El conjunto $\\mathbb{R}$ admite decimales perfectamente.`
                    };
                },

                // ARCHETYPE 2: AN√ÅLISIS DIMENSIONAL (Trampa de Suma)
                dimensional_trap: () => {
                    const v = r(40, 80); // km/h
                    const t = r(2, 5); // h
                    const dist = v * t;
                    const fakeSum = v + t;

                    return {
                        id: Math.random(),
                        category: "An√°lisis Dimensional",
                        text: `Un auto viaja a velocidad $v = ${v} \\text{ km/h}$ durante un tiempo $t = ${t} \\text{ h}$. Un estudiante distra√≠do calcula el "impacto total" sumando $${v} + ${t} = ${fakeSum}$. ¬øPor qu√© es esto inv√°lido?`,
                        options: [
                            { id: "A", text: `No es inv√°lido, ${fakeSum} es un indicador de rendimiento.` },
                            { id: "B", text: `Inv√°lido porque viola la Consistencia Dimensional: est√°s sumando Velocidad + Tiempo.`, correct: true },
                            { id: "C", text: `El resultado deber√≠a ser $${v * t}$ porque la f√≥rmula es $d = v \\cdot t$.` },
                            { id: "D", text: `Es v√°lido si convertimos las horas a minutos primero.` }
                        ],
                        explanation: `<strong>Peras con Manzanas:</strong> La suma solo existe para elementos de la <strong>misma naturaleza</strong>. $[L/T] + [T]$ es imposible f√≠sicamente. La √∫nica operaci√≥n v√°lida aqu√≠ es multiplicar para cancelar el tiempo: $${v} \\frac{\\text{km}}{\\cancel{\\text{h}}} \\cdot ${t} \\cancel{\\text{h}} = ${dist} \\text{ km}$.`
                    };
                },

                // ARCHETYPE 3: INVARIANZA DE PORCENTAJES
                percentage_invariance: () => {
                    const gain = r(10, 50);
                    const usdRate = 4000;

                    return {
                        id: Math.random(),
                        category: "Invarianza Porcentual",
                        text: `Compras un activo en $100 USD$ y lo vendes en $${100 + gain} USD$ (Ganancia del $${gain}\\%$). Si calculas esta misma operaci√≥n en Pesos Colombianos (Tasa $1:${usdRate}$), ¬øcu√°l ser√° tu porcentaje de ganancia?`,
                        options: [
                            { id: "A", text: `Mayor al ${gain}%, porque el peso es una moneda m√°s "grande" num√©rica.` },
                            { id: "B", text: `Exactamente ${gain}%.`, correct: true },
                            { id: "C", text: `Menor al ${gain}%, por la devaluaci√≥n.` },
                            { id: "D", text: `${gain * usdRate}%, se multiplica por la tasa de cambio.` }
                        ],
                        explanation: `<strong>El Porcentaje es Adimensional:</strong> $$ \\% = \\frac{\\text{Beneficio} \\cdot \\text{Tasa}}{\\text{Costo} \\cdot \\text{Tasa}} $$. La tasa de cambio aparece arriba y abajo en la fracci√≥n, por lo tanto <strong>se cancela</strong>. La rentabilidad es intr√≠nseca al negocio, no a la moneda.`
                    };
                },

                // ARCHETYPE 4: EFICIENCIA (COSTO/BENEFICIO)
                cost_benefit: () => {
                    // Option A: Base
                    const gA = r(2, 4) * 100; // grams
                    const pA = r(2, 5) * 1000; // price
                    const effA = gA / pA;

                    // Option B: Better
                    const gB = r(5, 8) * 100;
                    const pB = r(6, 9) * 1000;
                    const effB = gB / pB;

                    const best = effA > effB ? "A" : "B";
                    const bestEff = Math.max(effA, effB).toFixed(4);
                    const worstEff = Math.min(effA, effB).toFixed(4);

                    return {
                        id: Math.random(),
                        category: "Costo/Beneficio",
                        text: `Debes elegir el proveedor m√°s eficiente. <br>‚Ä¢ <strong>Opci√≥n A:</strong> ${gA}g por $${pA}. <br>‚Ä¢ <strong>Opci√≥n B:</strong> ${gB}g por $${pB}.`,
                        options: [
                            { id: "A", text: `La Opci√≥n A es mejor.`, correct: best === "A" },
                            { id: "B", text: `La Opci√≥n B es mejor.`, correct: best === "B" },
                            { id: "C", text: `Son equivalentes.` },
                            { id: "D", text: `No se puede saber sin conocer la calidad.` }
                        ],
                        explanation: `<strong>Tasa de Eficiencia:</strong> Calculamos gramos por peso ($\\frac{g}{\\$}$). <br>A: $${(effA).toFixed(5)}$. B: $${(effB).toFixed(5)}$. <br>La opci√≥n <strong>${best}</strong> te da m√°s producto por tu dinero.`
                    };
                },

                // ARCHETYPE 5: NOTACI√ìN CIENT√çFICA (SUMA)
                sci_not_sum: () => {
                    const base = r(2, 8);
                    const exp = r(3, 6);
                    const diff = r(1, 2);
                    // Problem: A * 10^exp + B * 10^(exp-diff)

                    return {
                        id: Math.random(),
                        category: "Notaci√≥n Cient√≠fica",
                        text: `Al sumar $3 \\times 10^{${exp}} + 2 \\times 10^{${exp - diff}}$, ¬øcu√°l es el procedimiento correcto?`,
                        options: [
                            { id: "A", text: `Sumar bases ($3+2=5$) y mantener exponente mayor ($10^{${exp}}$).` },
                            { id: "B", text: `Igualar exponentes primero: Convertir $3 \\times 10^{${exp}}$ a $30... \\times 10^{${exp - diff}}$ o viceversa.`, correct: true },
                            { id: "C", text: `Multiplicar las bases y sumar los exponentes.` },
                            { id: "D", text: `Solo se pueden sumar si los exponentes son negativos.` }
                        ],
                        explanation: `<strong>Zoom Match:</strong> No puedes sumar cantidades con "zoom" diferente. Debes expresar todo en la misma potencia de 10 para operar los coeficientes (factor com√∫n).`
                    };
                }
            };

            // Seleccionar plantilla basada en el m√≥dulo (prioridad) o aleatoria
            // Por ahora, forzamos Aritm√©tica si no se especifica, ya que es el foco del M√≥dulo 1.
            const keys = Object.keys(aritmeticaTemplates);
            const randomType = keys[Math.floor(Math.random() * keys.length)];
            return aritmeticaTemplates[randomType]();
        };

        // --- COMPONENTES UI (Iguales al original, estructura mantenida) ---

        const MenuButton = ({ onClick }) => (
            <button onClick={onClick} className="fixed top-4 left-4 z-50 p-3 bg-slate-900 text-white rounded-full shadow-lg hover:bg-slate-800 transition-all md:hidden">
                <Icon path={Icons.Menu} />
            </button>
        );

        const Sidebar = ({ isOpen, setView, activeView, closeSidebar }) => (
            <>
                {isOpen && <div className="fixed inset-0 bg-black/60 z-30 md:hidden fade-in" onClick={closeSidebar}></div>}
                <aside className={`fixed inset-y-0 left-0 z-40 w-80 bg-slate-900 text-slate-100 transform transition-transform duration-300 ease-in-out ${isOpen ? 'translate-x-0' : '-translate-x-full'} md:relative md:translate-x-0 flex flex-col shadow-2xl`}>
                    <div className="p-8 border-b border-slate-800">
                        <h2 className="font-black text-2xl text-white mb-2 tracking-tight">El Traductor</h2>
                        <p className="text-slate-400 text-sm font-medium">Edici√≥n Libro Maestro</p>
                    </div>

                    <nav className="flex-1 overflow-y-auto p-4 space-y-3">
                        <div className="text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 ml-2 mt-2">Cap√≠tulos de Estudio</div>
                        {educationalModules.map((mod) => (
                            <button
                                key={mod.id}
                                onClick={() => { setView('learn', mod.id); closeSidebar(); }}
                                className={`w-full flex items-start gap-4 px-4 py-4 rounded-xl transition-all group relative overflow-hidden ${activeView.id === mod.id && activeView.mode === 'learn' ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}
                            >
                                <div className={`mt-1 relative z-10 transition-transform group-hover:scale-110 ${activeView.id === mod.id ? 'text-white' : 'text-slate-500 group-hover:text-blue-400'}`}>
                                    <Icon path={Icons[mod.icon]} size={20} />
                                </div>
                                <div className="text-left relative z-10">
                                    <span className="block font-bold text-base">{mod.title}</span>
                                    <span className={`block text-xs mt-1 leading-snug ${activeView.id === mod.id ? 'text-blue-100' : 'text-slate-600 group-hover:text-slate-400'}`}>{mod.concept}</span>
                                </div>
                                {activeView.id === mod.id && <div className="absolute inset-0 bg-gradient-to-r from-blue-600 to-blue-500 z-0"></div>}
                            </button>
                        ))}

                        <div className="my-8 border-t border-slate-800"></div>
                        <div className="text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 ml-2">Evaluaci√≥n</div>
                        <button
                            onClick={() => { setView('quiz'); closeSidebar(); }}
                            className={`w-full flex items-center gap-4 px-4 py-5 rounded-xl transition-all ${activeView.mode === 'quiz' ? 'bg-indigo-600 text-white shadow-lg' : 'bg-slate-800/50 text-slate-300 hover:bg-indigo-900/30 hover:text-white border border-slate-800'}`}
                        >
                            <Icon path={Icons.Target} className="text-indigo-400" />
                            <div className="text-left">
                                <span className="block font-bold">Simulador Infinito</span>
                                <span className="block text-xs text-slate-500 mt-1">Generaci√≥n Procedural</span>
                            </div>
                        </button>
                    </nav>
                </aside>
            </>
        );

        const BookChapter = ({ title, content }) => (
            <div className="mb-12 pl-6 border-l-4 border-slate-200 hover:border-blue-600 transition-all duration-300">
                <h3 className="text-xl font-bold text-slate-900 mb-4">{title}</h3>
                <MathRender className="prose-custom" content={content} />
            </div>
        );

        const LearningView = ({ module }) => {
            return (
                <div className="w-full h-screen overflow-y-auto bg-white">
                    <div className={`${module.color} text-white p-8 md:p-16 relative overflow-hidden shadow-2xl`}>
                        <div className="absolute top-0 right-0 p-32 bg-white opacity-5 rounded-full transform translate-x-1/2 -translate-y-1/2"></div>
                        <div className="max-w-4xl mx-auto relative z-10">
                            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-black/20 text-xs font-bold uppercase tracking-widest mb-6 backdrop-blur-sm">
                                <Icon path={Icons.Book} size={14} /> M√≥dulo Maestro
                            </div>
                            <h1 className="text-4xl md:text-6xl font-black mb-6 tracking-tight">{module.title}</h1>
                            <p className="text-xl md:text-2xl text-white/90 font-medium leading-relaxed max-w-2xl">{module.summary}</p>
                        </div>
                    </div>

                    <div className="max-w-4xl mx-auto p-8 md:p-16 pb-32">
                        {module.chapters ? (
                            module.chapters.map((chapter, index) => (
                                <BookChapter key={index} title={chapter.title} content={chapter.content} />
                            ))
                        ) : (
                            <div className="text-center py-20 text-slate-500">
                                Contenido en construcci√≥n para este m√≥dulo.
                            </div>
                        )}

                        <div className="mt-20 p-8 bg-slate-50 rounded-2xl border border-slate-200 shadow-sm">
                            <h4 className="font-bold text-slate-900 mb-6 flex items-center gap-2 text-lg">
                                <Icon path={Icons.Brain} className="text-slate-600" /> Reglas de Oro para el Examen
                            </h4>
                            <ul className="space-y-4">
                                {module.tips && module.tips.map((tip, i) => (
                                    <li key={i} className="flex gap-4 text-slate-700 items-start">
                                        <div className="mt-1 p-1 bg-green-100 rounded-full text-green-700 shrink-0">
                                            <Icon path={Icons.Check} size={14} />
                                        </div>
                                        <div className="text-base"><MathRender content={tip} /></div>
                                    </li>
                                ))}
                            </ul>
                        </div>
                    </div>
                </div>
            );
        };

        const QuizView = () => {
            const [question, setQuestion] = useState(null);
            const [selected, setSelected] = useState(null);
            const [score, setScore] = useState(0);
            const [streak, setStreak] = useState(0);

            const nextQuestion = () => {
                setQuestion(generateQuestion());
                setSelected(null);
            };

            useEffect(() => {
                nextQuestion();
            }, []);

            const handleSelect = (opt) => {
                if (selected) return;
                setSelected(opt);
                if (opt.correct) {
                    setScore(s => s + 10);
                    setStreak(s => s + 1);
                } else {
                    setStreak(0);
                }
            };

            if (!question) return <div className="flex h-screen items-center justify-center text-slate-500">Cargando simulador...</div>;

            return (
                <div className="w-full h-screen overflow-y-auto bg-slate-50 flex items-center justify-center p-4">
                    <div className="max-w-2xl w-full">
                        <div className="flex justify-between items-end mb-6 px-2">
                            <div>
                                <h2 className="text-2xl font-black text-slate-800">Simulador</h2>
                                <p className="text-slate-500 text-sm">Pr√°ctica infinita (Nuevos temas incluidos)</p>
                            </div>
                            <div className="flex gap-4">
                                <div className="text-right">
                                    <span className="text-xs font-bold text-slate-400 uppercase">Puntos</span>
                                    <div className="text-xl font-black text-indigo-600">{score}</div>
                                </div>
                                <div className="text-right">
                                    <span className="text-xs font-bold text-slate-400 uppercase">Racha</span>
                                    <div className="text-xl font-black text-orange-500">{streak}</div>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden relative">
                            <div className="p-8 md:p-10">
                                <span className="inline-block px-3 py-1 bg-indigo-50 text-indigo-700 text-xs font-bold rounded-full mb-6 uppercase tracking-wide border border-indigo-100">
                                    {question.category}
                                </span>
                                <h3 className="text-xl md:text-2xl font-bold text-slate-800 mb-8 leading-relaxed">
                                    <MathRender content={question.text} />
                                </h3>

                                <div className="space-y-3">
                                    {question.options.map((opt) => (
                                        <button
                                            key={opt.id}
                                            onClick={() => handleSelect(opt)}
                                            disabled={!!selected}
                                            className={`w-full p-5 rounded-2xl text-left border-2 transition-all relative group
                                                ${selected
                                                    ? opt.correct
                                                        ? 'bg-green-50 border-green-500 text-green-900'
                                                        : opt === selected
                                                            ? 'bg-red-50 border-red-500 text-red-900'
                                                            : 'bg-slate-50 border-slate-100 text-slate-400 opacity-50'
                                                    : 'bg-white border-slate-100 hover:border-indigo-500 hover:shadow-md text-slate-700 font-medium btn-bounce'
                                                }
                                            `}
                                        >
                                            <div className="flex items-start gap-4">
                                                <span className={`font-black text-lg ${selected && opt.correct ? 'text-green-600' : 'text-slate-300 group-hover:text-indigo-500'}`}>{opt.id}</span>
                                                <span className="mt-0.5"><MathRender content={opt.text} /></span>
                                            </div>

                                            {selected && opt.correct && (
                                                <div className="absolute right-6 top-1/2 -translate-y-1/2 text-green-600 bg-white rounded-full p-1 shadow-sm">
                                                    <Icon path={Icons.Check} />
                                                </div>
                                            )}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {selected && (
                                <div className="bg-slate-900 p-8 md:p-10 text-white slide-up">
                                    <div className="flex gap-4 mb-4">
                                        <div className={`p-2 rounded-lg ${selected.correct ? 'bg-green-500' : 'bg-red-500'}`}>
                                            <Icon path={selected.correct ? Icons.Check : Icons.X} size={24} className="text-white" />
                                        </div>
                                        <div>
                                            <div className="font-bold text-lg">
                                                {selected.correct ? '¬°Correcto!' : 'An√°lisis del Error'}
                                            </div>
                                            <div className="text-slate-400 text-sm">Entendiendo la l√≥gica del ICFES</div>
                                        </div>
                                    </div>

                                    <div className="text-slate-300 mb-8 leading-relaxed border-l-2 border-slate-700 pl-4">
                                        <MathRender content={question.explanation} />
                                    </div>

                                    <button
                                        onClick={nextQuestion}
                                        className="w-full py-4 bg-white text-slate-900 font-bold rounded-xl hover:bg-indigo-50 transition-colors flex items-center justify-center gap-2"
                                    >
                                        Siguiente Desaf√≠o <Icon path={Icons.ArrowRight} />
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [sidebarOpen, setSidebarOpen] = useState(false);
            const [mode, setMode] = useState('learn'); // 'learn' or 'quiz'
            const [moduleId, setModuleId] = useState('aritmetica');

            const activeView = { mode, id: moduleId };
            const currentModule = educationalModules.find(m => m.id === moduleId);

            const handleSetView = (newMode, newId) => {
                setMode(newMode);
                if (newId) setModuleId(newId);
            };

            return (
                <div className="flex h-screen bg-white overflow-hidden">
                    <MenuButton onClick={() => setSidebarOpen(true)} />
                    <Sidebar
                        isOpen={sidebarOpen}
                        closeSidebar={() => setSidebarOpen(false)}
                        activeView={activeView}
                        setView={handleSetView}
                    />

                    <main className="flex-1 h-full relative">
                        {mode === 'learn' ? (
                            <LearningView module={currentModule} />
                        ) : (
                            <QuizView />
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>